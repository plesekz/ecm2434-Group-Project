<!DOCTYPE html>
<html>
<style>
    @import url("battle_animation.css");
</style>
<body>
    <p>
        <!--buttons, for testing-->
        <button onclick="battle()">battle</button>
    </p>
    <!-- health bars -->
    <div id="arena">
        <div id="bars">
            <div id="lHealthBar">
                <div id="lHealthFill"></div>
            </div>
            <div id="lShieldBar">
                <div id="lShieldFill"></div>
            </div>
            <div id="rHealthBar">
                <div id="rHealthFill"></div>
            </div>
            <div id="rShieldBar">
                <div id="rShieldFill"></div>
            </div>
        </div>
        
        <div id ="leftCharacter">
            <div id ="lBodyShield"></div>
            <div id ="lBody"></div>
            <div id= "lArmShield"></div>
            <div id ="lWeapon"></div>
            <div id ="lArm"></div>
        </div>
    
        <div id ="rightCharacter">
            <div id ="rBodyShield"></div>
            <div id ="rBody"></div>
            <div id ="rArmShield"></div>
            <div id ="rWeapon"></div>
            <div id ="rArm"></div>
        </div>
    </div>
    
    <script>
        var animating = false;
        //keeps track of health and shield values as a percentage
        var lhealthleft = 100;
        var lshieldleft = 100;
        var rhealthleft = 100;
        var rshieldleft = 100;
        
        function sleep (time) {
            return new Promise((resolve) => setTimeout(resolve, time));
        }
        
        async function leftMelee() {
        
            //variables
            var character = document.getElementById("leftCharacter");
            var arm = document.getElementById("lArm");
            var shield = document.getElementById("lArmShield");
            var weapon = document.getElementById("lWeapon");
            pos = 2;
            deg = 60;
            
            while (animating) {
                await sleep(100);
            }
            animating = true;
            
            //move forward
            while (pos < (7)) {
                pos+=(0.25);
                character.style.left = pos + '%';
                await sleep(5);
            }
            
            //ready swing
            while (deg > -40) {
                if (deg < -40) {
                    deg = -39;
                }
                deg-=1;
                arm.style.transform = 'rotate(' + deg + 'deg)';
                shield.style.transform = 'rotate(' + deg + 'deg)';
                weapon.style.transform = 'rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //swing
            while (deg < 90) {
                if (deg > 90) {
                    deg = 88;
                }
                deg+=2;
                arm.style.transform = 'rotate(' + deg + 'deg)';
                shield.style.transform = 'rotate(' + deg + 'deg)';
                weapon.style.transform = 'rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //return arm to position
            while (deg > 60) {
                if (deg < 60) {
                    deg = 59;
                }
                deg-=1;
                arm.style.transform = 'rotate(' + deg + 'deg)';
                shield.style.transform = 'rotate(' + deg + 'deg)';
                weapon.style.transform = 'rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //move back
            while (pos > 2) {
                pos-=0.25;
                character.style.left = pos + '%';
                await sleep(5);
            }
            
            animating = false;
            
            return true;
        }
        async function rightMelee() {
        
            //variables
            var character = document.getElementById("rightCharacter");
            var arm = document.getElementById("rArm");
            var shield = document.getElementById("rArmShield");
            var weapon = document.getElementById("rWeapon");
            pos = 2;
            deg = 60;
            
            while (animating) {
                await sleep(40);
            }
            animating = true;
            
            //move forward
            while (pos < 7) {
                pos+=0.25;
                character.style.right = pos + '%';
                await sleep(5);
            }
            
            //ready swing
            while (deg > -40) {
                if (deg < -40) {
                    deg = -39;
                }
                deg-=1;
                arm.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                shield.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                weapon.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //swing
            while (deg < 90) {
                if (deg > 90) {
                    deg = 88;
                }
                deg+=2;
                arm.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                shield.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                weapon.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //return arm to position
            while (deg > 60) {
                if (deg < 60) {
                    deg = 59;
                }
                deg-=1;
                arm.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                shield.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                weapon.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                await sleep(5);
            }
            
            //move back
            while (pos > 2) {
                pos-=0.25;
                character.style.right = pos + '%';
                await sleep(5);
            }
            
            animating = false;
            
            return true;
        }
        
        async function leftRanged() {
        
            //variables
            var character = document.getElementById("leftCharacter");
            var arm = document.getElementById("lArm");
            var shield = document.getElementById("lArmShield");
            var weapon = document.getElementById("lWeapon");
            pos = 2;
            deg = 60;
            
            while (animating) {
                await sleep(40);
            }
            animating = true;
            
            while (deg > 45) {
                if (deg < 45) {
                    deg = 45;
                }
                deg-=1;
                arm.style.transform = 'rotate(' + deg + 'deg)';
                shield.style.transform = 'rotate(' + deg + 'deg)';
                weapon.style.transform = 'rotate(' + deg + 'deg)';
                await sleep(15);
            }
            
            
            //recoil
            weapon.style.left = '-55%';
            arm.style.left = '-54.5%';
            shield.style.left = '-54.5%';
            await sleep(100);
            weapon.style.left = '-54.5%';
            arm.style.left = '-54.25%';
            shield.style.left = '-54.25%';
            await sleep(100);
            weapon.style.left = '-54%';
            arm.style.left = '-54%';
            shield.style.left = '-54%';
            
            //return to position
            while (deg < 60) {
                if (deg > 60) {
                    deg = 61;
                }
                deg+=1;
                arm.style.transform = 'rotate(' + deg + 'deg)';
                shield.style.transform = 'rotate(' + deg + 'deg)';
                weapon.style.transform = 'rotate(' + deg + 'deg)';
                await sleep(20);
            }
            
            animating = false;
            return true;
        }
        async function rightRanged() {
            //variables
            var character = document.getElementById("rightCharacter");
            var arm = document.getElementById("rArm");
            var shield = document.getElementById("rArmShield");
            var weapon = document.getElementById("rWeapon");
            pos = 2;
            deg = 60;
            
            while (animating) {
                await sleep(40);
            }
            animating = true;
            
            while (deg > 45) {
                if (deg < 45) {
                    deg = 45;
                }
                deg-=1;
                arm.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                shield.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                weapon.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                await sleep(15);
            }
            
            
            //recoil
            weapon.style.left = '-55%';
            arm.style.left = '-54.5%';
            shield.style.left = '-54.5%';
            await sleep(100);
            weapon.style.left = '-54.5%';
            arm.style.left = '-54.25%';
            shield.style.left = '-54.25%';
            await sleep(100);
            weapon.style.left = '-54%';
            arm.style.left = '-54%';
            shield.style.left = '-54%';
            
            //return to position
            while (deg < 60) {
                if (deg > 60) {
                    deg = 61;
                }
                deg+=1;
                arm.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                shield.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                weapon.style.transform = 'scaleX(-1) rotate(' + deg + 'deg)';
                await sleep(20);
            }
            
            animating = false;
            return true;
        }
        
        async function leftTakeHealthDamage(dmg) {
            var bar = document.getElementById("lHealthFill");
            var current = lhealthleft;
            lhealthleft -= dmg;
            for (var i = current; i>=lhealthleft; i-=0.25) {
                bar.style.width = i + '%';
                await sleep(1);
            }
            return true;
        }
        async function leftTakeShieldDamage(dmg) {
            var bar = document.getElementById("lShieldFill");
            var bodyshield = document.getElementById("lBodyShield");
            var armshield = document.getElementById("lArmShield");
            var current = lshieldleft;
            lshieldleft -= dmg;
            for (var i = current; i>=lshieldleft; i-=0.25) {
                bar.style.width = i + '%';
                bodyshield.style.opacity = (i/100);
                armshield.style.opacity = (i/100);                
                await sleep(1);
            }
            return true;   
        }
        async function rightTakeHealthDamage(dmg) {
            var bar = document.getElementById("rHealthFill");
            var current = rhealthleft;
            rhealthleft -= dmg;
            for (var i = current; i>=rhealthleft; i-=0.25) {
                bar.style.width = i + '%';
                await sleep(1);
            }
            return true;
        }
        async function rightTakeShieldDamage(dmg) {
            var bar = document.getElementById("rShieldFill");
            var bodyshield = document.getElementById("rBodyShield");
            var armshield = document.getElementById("rArmShield");
            var current = rshieldleft;
            rshieldleft -= dmg;
            for (var i = current; i>=rshieldleft; i-=0.25) {
                bar.style.width = i + '%';
                bodyshield.style.opacity = (i/100);
                armshield.style.opacity = (i/100);                
                await sleep(1);
            }
            return true;
        }
        
        
        function setup(lClass, leftWeapon, rClass, rightWeapon) {
            //left character variables
            var lBody = document.getElementById("lBody");
            var lbShield = document.getElementById("lBodyShield");
            var lArm = document.getElementById("lArm");
            var laShield = document.getElementById("lArmShield");
            var lWeapon = document.getElementById("lWeapon");
            
            //right character variables
            var rBody = document.getElementById("rBody");
            var rbShield = document.getElementById("rBodyShield");
            var rArm = document.getElementById("rArm");
            var raShield = document.getElementById("rArmShield");
            var rWeapon = document.getElementById("rWeapon");
            
            
            //sets sprites to the correct sprite and size
            lBody.style.background = 'url(sprites/' + lClass + '/body.png) no-repeat'; //sets image
            lBody.style.backgroundSize = '100% 100%';                                  //scales image to the correct size
            lbShield.style.background = 'url(sprites/' + lClass + '/bodyshield.png)';
            lbShield.style.backgroundSize = '100% 100%';
            lArm.style.background = 'url(sprites/' + lClass + '/arm.png)';
            lArm.style.backgroundSize = '100% 100%';
            laShield.style.background = 'url(sprites/' + lClass + '/armshield.png)';
            laShield.style.backgroundSize = '100% 100%';
            lWeapon.style.background = 'url(sprites/weapons/' + leftWeapon + '.png)';
            lWeapon.style.backgroundSize = '100% 100%';
            
            rBody.style.background = 'url(sprites/' + rClass + '/body.png) no-repeat';
            rBody.style.backgroundSize = '100% 100%';            
            rbShield.style.background = 'url(sprites/' + rClass + '/bodyshield.png)';
            rbShield.style.backgroundSize = '100% 100%';
            rArm.style.background = 'url(sprites/' + rClass + '/arm.png)';
            rArm.style.backgroundSize = '100% 100%';
            raShield.style.background = 'url(sprites/' + rClass + '/armshield.png)';
            raShield.style.backgroundSize = '100% 100%';
            rWeapon.style.background = 'url(sprites/weapons/' + rightWeapon + '.png)';
            rWeapon.style.backgroundSize = '100% 100%';
               
        }
        
        async function battle() {
            
            await leftTakeHealthDamage(30);
            await leftTakeShieldDamage(40);
            await rightTakeHealthDamage(20);
            await rightTakeShieldDamage(100);
            
            //gets turn order and plays it out
            //await leftMelee();
            //await rightMelee();
            //await leftRanged();
            //await rightRanged();
        }
        setup("psionic", "shiv", "soldier", "assaultrifle");
    </script>
</body>
</html>